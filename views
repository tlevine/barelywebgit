#!/bin/sh

# --------------------------------------------------------------------------- #
# Begin settings
# --------------------------------------------------------------------------- #

# SSH
SSH_ACCOUNT=accountname_sitename@ssh.phx.nearlyfreespeech.net

# HTTP authentication
# Define these to make the web display private.
# USERNAME=tlevine
# PASSWORD=chainsaws

# Filesystem, with trailing slashes
REPOSITORIES_DIR=/home/private/
PUBLIC_HTML_DIR=/home/public/
HTPASSWD_FILE=/home/protected/.htpasswd
BARELYWEBGIT_REPOSITORY=/home/private/barelywebgit/
TMP=/tmp

# --------------------------------------------------------------------------- #
# End settings
# --------------------------------------------------------------------------- #

cd $BARELYWEBGIT_REPOSITORY
. models

index() {
  # Retrieve repository list.
  repositories=models_repositories "$REPOSITORIES_DIR"

  # Make rows.
  echo > $TMP/_repository_rows.html
  for repository_full in ${repositories[@]}
    do
    repository_partial="`echo $repository_full|sed s/^${REPOSITORIES_DIR}//`"
    sed "s/{{repository path}}/${repository_partial}/g" \
      templates/_repository_row.html >> "${TMP}"/_repository_rows.html
  done

  # Add to the template.
  sed "/{-repository rows-}/r ${TMP}/_repository_rows.html" \
    templates/index.html > $PUBLIC_html_dir/index.html
  rm $TMP/_repository_rows.html

  # Other variables
  sed -i -e "s/{{SSH account}}/${SSH_ACCOUNT}/g" \
    $PUBLIC_html_dir/index.html
}

htpasswd() {

}

# Run things
index
# htpasswd
